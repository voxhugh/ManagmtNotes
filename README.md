# Linux基础



**Linux 下文件和目录的特点**

* `.` 开头是隐藏文件，用 -a 显示
* **.** 代表当前目录
* **..** 代表上一级目录
* **文件**/**目录** 名称最长 `256` 个字符
* 所有的 **目录** 和 **文件名** 对大小写敏感

**目录下文件的详细信息**

​	权限 硬链接数 拥有者 组大小 时间 名称

<img src="https://github.com/voxhugh/Appendix/blob/main/Cpp_IMGs/Rights.png" style="zoom:70%;" />

**passwd 文件**

`/etc/passwd` 文件存放的是用户的信息，由 6 个分号组成的 7 个信息，分别是

1. 用户名
2. 密码（x，表示加密的密码）
3. UID（用户标识）
4. GID（组标识）
5. 用户全名或本地帐号
6. 家目录
7. 登录使用的 Shell，就是登录之后，使用的终端命令，`ubuntu` 默认是 `dash`



`/etc` 目录是专门用来保存 **系统配置信息** 的目录

`/etc/passwd` 是用于保存用户信息的文件

`/usr/bin/passwd` 是用于修改用户密码的程序

`/etc/group` 是用于保存组信息的文件



**`bin` 和 `sbin`**

* 在 `Linux` 中，绝大多数可执行文件都是保存在 `/bin`、`/sbin`、`/usr/bin`、`/usr/sbin`
* `/bin`（`binary`）是二进制执行文件目录，主要用于具体应用
* `/sbin`（`system binary`）是系统管理员专用的二进制代码存放目录，主要用于系统管理
* `/usr/bin`（`user commands for applications`）后期安装的一些软件
* `/usr/sbin`（`super user commands for applications`）超级用户的一些管理程序

> * `cd` 这个终端命令是内置在系统内核中的，没有独立的文件，因此用 `which` 无法找到 `cd` 命令的位置

## 终端命令

#### 基本操作

`tab`	自动补齐

`↑/↓`	曾经使用过的命令

`ctrl + c`	取消

`command --help`	显示 `command` 命令的帮助信息

`man command`      	查阅 `command` 命令的使用手册

| 操作键 | 功能                 |
| :----- | :------------------- |
| 空格   | 显示手册页的下一屏   |
| Enter  | 一次滚动手册页的一行 |
| b      | 回滚一屏             |
| f      | 前滚一屏             |
| q      | 退出                 |
| /word  | 搜索 **word** 字符串 |

| 通配符 | 含义                                 |
| ------ | ------------------------------------ |
| *      | 代表任意个数个字符                   |
| ?      | 代表任意一个字符，至少 1 个          |
| []     | 表示可以匹配字符组中的任一一个       |
| [abc]  | 匹配 a、b、c 中的任意一个            |
| [a-f]  | 匹配从 a 到 f 范围内的的任意一个字符 |

#### 文件操作

| cd    | 变更当前工作目录                       |
| ----- | -------------------------------------- |
| cd    | 切换到当前用户的主目录(/home/用户目录) |
| cd ~  | 切换到当前用户的主目录(/home/用户目录) |
| cd .  | 保持在当前目录不变                     |
| cd .. | 切换到上级目录                         |
| cd -  | 可以在最近两次工作目录之间来回切换     |

| ls   | 显示目录内容                                 |
| ---- | -------------------------------------------- |
| -a   | 显示指定目录下所有子目录与文件，包括隐藏文件 |
| -l   | 以列表方式显示文件的详细信息                 |
| -h   | 配合 -l 以人性化的方式显示文件大小           |

| rm   | 删除文件或目录                                        |
| ---- | ----------------------------------------------------- |
| -f   | 强制删除，忽略不存在的文件，无需提示                  |
| -r   | 递归地删除目录下的内容，**删除文件夹** 时必须加此参数 |

| cp   | 复制给定文件或目录至另一个文件或目录中                       |
| ---- | :----------------------------------------------------------- |
| -i   | 覆盖文件前提示                                               |
| -r   | 若源文件是目录文件，将递归复制该目录下的所有子目录和文件，目标文件必须为一个目录名 |

| cat  | 查看文件内容、创建文件、文件合并、追加文件内容等 |
| ---- | ------------------------------------------------ |
| -b   | 对非空输出行编号                                 |
| -n   | 对输出的所有行编号                               |

| grep | 文本搜索                                 |
| ---- | ---------------------------------------- |
| -n   | 显示匹配行及行号                         |
| -v   | 显示不包含匹配文本的所有行（相当于求反） |
| -i   | 忽略大小写                               |

| 参数 | 含义                         |
| ---- | ---------------------------- |
| ^a   | 行首，搜寻以 **a** 开头的行  |
| ke$  | 行尾，搜寻以 **ke** 结束的行 |

`touch`	创建文件或修改文件末次修改时间

`mkdir`	创建一个新的目录	[-p 递归]

`tree [目录名]`	  以树状图列出文件目录结构	[-d 只显示目录]

`cp 源文件 目标文件`	  复制文件或者目录

`mv 源文件 目标文件`	  移动文件或者目录／文件或者目录重命名

`mv` 	移动并重命名文件或目录

`more` 	分屏显示文件内容，每次显示一页

`echo`	显示参数指定的文字

`>`	输出

`>>`	追加

`|`	将一个命令的输出通过管道做为另一命令的输入

`find`	在特定的目录下搜索符合条件的文件	[-name "*.txt" 按名称]

`ln -s 被链接的源文件 链接文件`	建立文件的软链接	[-s 软链接]

#### 用户／组 权限

| usermod                     | 设置用户的主组／附加组和登录Shell |
| --------------------------- | --------------------------------- |
| usermod -g 组 用户名        | 修改用户的主组（passwd 中的 GID） |
| usermod -G 组 用户名        | 修改用户的附加组                  |
| usermod -s /bin/bash 用户名 | 修改用户登录 Shell                |

`su`	使用另一个用户的身份

`sudo`	以其他身份来执行命令，预设的身份为 `root`

`groupadd 组名`	  添加组

`groupdel 组名`	删除组

`cat /etc/group`	确认组信息

`chgrp -R 组名 文件/目录名`	递归修改文件/目录的所属组

`useradd -m -g 组 新建用户名`	  添加新用户	[-m 自动建立用户家目录，-g 指定用户所在的组]

`passwd 用户名`	设置用户密码

`userdel -r 用户名`	  删除用户	[自动删除用户家目录]

`cat /etc/passwd \| grep 用户名`	确认用户信息

`id [用户名]`	查看用户 UID 和 GID 信息

`who`	  查看当前所有登录的用户列表

`whoami`	  查看当前登录用户的账户名

`which` 	查看执行命令所在位置

`su - 用户名`	切换用户，并且切换目录	[  - 切换到用户家目录]

`exit`	  退出当前登录账户

`chown 用户名 文件名|目录名`	修改文件|目录的拥有者

`chgrp -R 组名 文件名|目录名`	递归修改文件|目录的组

`chmod +/-rwx 文件名|目录名`	修改用户／组对文件／目录的 读|写|执行 权限

#### 系统相关

| shutdown 选项 时间 | 关机／重新启动	[-r 重启]         |
| ------------------ | ----------------------------------- |
| shutdown -r now    | 重新启动操作系统，其中 now 表示现在 |
| shutdown now       | 立刻关机，其中 now 表示现在         |
| shutdown 20:25     | 系统在今天的 20:25 会关机           |
| shutdown +10       | 系统再过十分钟后自动关机            |
| shutdown -c        | 取消之前指定的关机计划              |

`date`	查看系统时间

`cal`	 查看日历，`-y` 选项可以查看一年的日历

`df -h`	显示磁盘剩余空间

`du -h [目录名]`	显示目录下的文件大小

`ps aux`	查看进程的详细状况

`top`	动态显示运行中的进程并且排序

`kill [-9] 进程代号`	  终止指定代号的进程，`-9` 表示强行终止

#### 网络

`ifconfig`	查看/配置计算机当前的网卡配置信息

`ping`	检测到目标 ip地址 的连接是否正常

#### SSH

`ssh 用户名@ip`	关机／重新启动	[-p port 指定端口号]

`scp 用户名@ip:文件名或路径 用户名@ip:文件名或路径`	远程复制文件

`ssh-keygen` 	生成 SSH 钥匙

`ssh-copy-id -p port user@remote`	上传公钥到服务器

**ssh配置别名，在 `~/.ssh/config` 下追加以下内容：**

```
Host 别名
    HostName ip地址
    User itheima
    Port 22
```

#### 打包&压缩

| 选项 | 含义                                                         |
| ---- | ------------------------------------------------------------ |
| c    | 生成档案文件，创建打包文件                                   |
| x    | 解开档案文件                                                 |
| v    | 列出归档解档的详细过程，显示进度                             |
| f    | 指定档案文件名称，f 后面一定是 .tar 文件，所以必须放选项最后 |

`tar -cvf 打包文件.tar 被打包的文件／路径...`	打包文件

`tar -xvf 打包文件.tar`	解包文件

`tar -zcvf 打包文件.tar.gz 被压缩的文件／路径...`	压缩文件

`tar -zxvf 打包文件.tar.gz`	解压缩文件

`tar -zxvf 打包文件.tar.gz -C 目标路径`	解压缩到指定路径	[-C 指定目录，必须存在]

`tar -jcvf 打包文件.tar.bz2 被压缩的文件／路径...`	压缩文件

`tar -jxvf 打包文件.tar.bz2`	解压缩文件

#### 其他

`sudo apt install 软件包`	安装软件

`sudo apt remove 软件名`	卸载软件

`sudo apt upgrade`	更新已安装的包

`git rebase --exec 'GIT_COMMITTER_DATE="$(git log -1 --format=%at)" git commit --amend --no-edit -n -S' -i HEAD~n`	为前n次commit签名

## Vim

Vim中共有三种模式： **命令模式**  **末行模式**  **编辑模式**



#### 命令模式

`vim 文件名`	打开文件

`ZZ`	保存退出

`gg=G`	代码格式化

`h`,`j`,`k`,`l`	光标移动

`0`	移至行首

`$`	移至行尾

`gg`	移至文件头

`G`	移至文件尾

`nG`	行跳转

`v`	字符可视模式

`V`	行可视模式

`ctrl + v`	块可视模式

`I`	insert模式（可进行//）

`d`	删除(剪切)

`dd`	删除当前行

`y`	复制

`yy`	复制当前行

`p`	粘贴

`u`	撤销

`ctrl + r`	反撤销

`/n`	向下查找

`#N`	向下查找本单词

#### 编辑模式

`i`	编辑模式

`o`	编辑模式（另起一行）

#### 末行模式

`:`	末行模式

`Esc × 2`	命令模式

`q`	退出

`q!`	强制退出

`w`	保存

`wq`	保存退出

`[行1,行2]s/旧值/新值/g`	  [行1,行2]替换

`%s/旧值/新值/g`	  全部替换

`vsp [文件名]`	垂直分屏

`-O`	vim打开文件时垂直分屏

`ctrl + w + w`	  屏幕间切换

`qall`	同时退出多个屏幕

`:行号`	行跳转

`!命令`	执行shell命令

## GCC

`gcc -o Dest a.c`

- **注意：c文件gcc，cpp文件g++**

**选项：**

`-E/S/c`	预处理/编译/汇编

`-o [destFile] [srcFile]`	链接

`-I`	指定头文件的搜索目录

`-L`	库的路径

`-l`	库名

`-fpic`	生成与位置无关的代码

`-shared`	生成共享目标文件

## 静态库&动态库

**静态库：libNAME.a**

**动态库：libNAME.so**

#### 静态库

**制作**

```shell
# 汇编
$ gcc srcFile.c -c
# 打包	c:创建库 s:创建索引 r:插入模块
$ ar rcs libNAME.a srcFile.o
# 发布：libNAME.a srcFile.h
```

**使用**

```shell
# 编译 静态库,头文件,测试代码
$ gcc -o Dest main.c -L ./ -l NAME
```

#### 动态库

**制作**

```shell
# 汇编
$ gcc srcFile.c -c -fpic
# 打包
$ gcc -o libNAME.so srcFile.o -shared
# 发布：libNAME.so srcFile.h
```

**使用**

```shell
# 编译 动态库,头文件,测试代码
$ gcc -o Dest main.c -L ./ -l NAME
```

**关于动态库无法加载问题**

`ldd`	检测程序能否加载到动态库

- 添加系统环境变量
  1. 找到配置文件 *~/.bashrc*		//此为用户级别，系统级别：*/etc/profile*
  2. 在文件中追加 `export LD_LIBRARY_PATH =$LD_LIBRARY_PATH :动态库的绝对路径`
  3. 重启终端或执行`. ~/.bashrc`	// . 是 source 的简写
- 更新系统动态库缓存
  1. 找到动态库所在的绝对路径（不含库名，例如：*/home/voxhugh/Library/*）
  2. 将以上路径追加至文件 */etc/ld.so.conf* 中
  3. 更新配置文件数据至缓存中 `sudo ldconfig`

- 拷贝库的软链接至库目录

## Makefile

**make：解释 makefile 中的指令，实现自动化编译**



**规则**

```makefile
# 每条规则的语法格式:
target1,target2...: depend1, depend2, ...
	command
	......
	......
```

**变量**

1. 自定义变量

   ```makefile
   # 定义时必须初始化
   obj=a.o  b.o  c.o  c.o
   $(obj)	# 取变量的值
   ```

3. 自动变量

   ```makefile
   $^	# 所有依赖文件	(以空格间隔且不重复)
   $@	# 目标文件
   $<	# 首个依赖文件	
   ```

**模式匹配**

```makefile
# 依赖一个,目标一个, 通过通配符 % 匹配文件名
%.o:%.c
	gcc $< -c
```

**函数**

```makefile
# 获取指定目录下指定类型的文件名
$(wildcard PATTERN...)
# 按指定模式替换指定文件名的后缀
$(patsubst <pattern>,<replacement>,<text>)

# wildcard举例: 
src = $(wildcard /home/Tom/a/*.c *.c)
# patsubst举例：
src = a.cpp b.cpp c.cpp
obj = $(patsubst %.cpp, %.o, $(src)) 
```

**完美编写示范**

```makefile
# 搜索当前目录下的源文件
src=$(wildcard *.c)
# 将源文件的后缀替换为 .o
obj=$(patsubst %.c, %.o, $(src))
target=Dest

# 链接
$(target):$(obj)
        gcc -o $(target) $(obj)

# 汇编
%.o:%.c
        gcc $< -c

# 删除 生成文件 可执行程序
.PHONY:clean	# 声明为伪文件，防止make检测时间戳
clean:
        -rm $(obj) $(target) 
        echo "hello"
```

## GDB调试

```shell
# -g 程序调试
$ gcc -o Dest main.c -g
# 启动gdb
$ gdb Dest
# 设置参数，启动时传入
$ set args 参数1 参数2 .... ...
# 查看命令行参数
$ show args
# 执行程序
$ r
# 查看代码			（a.c的第10行附近：a.c:10） 
$ l
# 第13行设置断点		（a.c中：a.c:13）
$ b 13
# 第20行设置条件断点
$ b 20 if i==5
# 查看断点
$ i b
# 删除前两个断点
$ d 1-2
# 设置 3 4 断点无效
$ dis 3 4
# 生效 3 断点
$ ena 3
# 继续执行
$ c
# 打印变量值
$ p i
# 打印变量类型
$ ptype array
# 自动显示变量 a[i]
$ display a[i]
# 查看自动显示列表
$ i display
# 删除 2-4 自动显示
$ undisplay 2-4
# 禁用 1 自动显示
$ dis display 1
# 当前 阻塞至函数1前一行，单步调试进入函数
$ s
# 函数内无有效断点，跳出
$ finish
# 当前 阻塞至函数2前一行，单步调试跳过函数
$ n
# 当前 刚进入循环体，在结束行执行跳出
$ until
# 当前 刚进入两位数循环，设置变量值实现跳出
$ set var i=100
# 退出gdb
$ q
```

